{"version":3,"file":"chat-sender.js","sources":["../../../components/chat/chat-sender.tsx"],"sourcesContent":["import { defineComponent, ref, computed, toRefs } from 'vue';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport props from './chat-sender-props';\nimport { SendFilledIcon } from 'tdesign-icons-vue-next';\nimport Button from '../button';\nimport Textarea from '../textarea';\nimport useVModel from '../hooks/useVModel';\nimport { useTNodeJSX, useContent } from '../hooks/tnode';\n\nimport type { TdChatSenderProps } from './type';\n\nexport default defineComponent({\n  name: 'TChatSender',\n  props,\n  emits: ['send', 'stop', 'focus', 'blur'], // declare the custom events here\n  setup(props, { emit }) {\n    let shiftDownFlag = false;\n    let isComposition = false;\n    const senderTextarea = ref(null);\n    const COMPONENT_NAME = usePrefixClass('chat');\n\n    const { value, modelValue } = toRefs(props);\n    const [textValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n\n    const focusFlag = ref(false);\n    const loading = ref(false);\n    const showStopBtn = computed(() => props.stopDisabled && loading.value);\n    const disabled = computed(() => props.disabled || false);\n\n    const renderTNodeJSX = useTNodeJSX();\n    const renderContent = useContent();\n    // 点击了发送按钮\n    const sendClick = (e: MouseEvent | KeyboardEvent) => {\n      if (textValue.value && !disabled.value) {\n        emit('send', textValue.value, { e });\n        loading.value = true;\n        textValue.value = '';\n      }\n    };\n    // 点击了停止按钮\n    const handleStop = (e: MouseEvent) => {\n      loading.value = false;\n      emit('stop', textValue.value, {\n        e,\n      });\n    };\n    const keydownFn = (value: string, context: { e: KeyboardEvent }) => {\n      const {\n        e: { key },\n      } = context;\n      if (key === 'Shift') {\n        shiftDownFlag = true;\n      }\n      if (key === 'Enter' && !shiftDownFlag && !isComposition) {\n        context.e.cancelBubble = true;\n        context.e.preventDefault();\n        context.e.stopPropagation();\n        sendClick(context.e);\n      }\n    };\n    const focusFn = (value: string, context: { e: FocusEvent }) => {\n      focusFlag.value = true;\n      emit('focus', value, context);\n    };\n\n    const blurFn = (value: string, context: { e: FocusEvent }) => {\n      focusFlag.value = false;\n      emit('blur', value, context);\n    };\n\n    const keyupFn = (value: string, context: { e: KeyboardEvent }) => {\n      const {\n        e: { key },\n      } = context;\n      if (key === 'Shift') {\n        shiftDownFlag = false;\n      }\n    };\n\n    const textChange = (value: string, context: { e: InputEvent }) => {\n      setInnerValue(value, context);\n    };\n    // 当用户通过输入法开始输入组合文字（如中文拼音输入）时触发\n    const compositionstartFn = () => {\n      isComposition = true;\n    };\n    // 当用户通过输入法完成组合文字的选择（如从候选词中选择中文）时触发\n    const compositionendFn = () => {\n      isComposition = false;\n    };\n    // 默认suffixIcon\n    const getDefaultSuffixIcon = () => {\n      return (\n        <Button\n          theme=\"default\"\n          size=\"small\"\n          variant=\"text\"\n          class={[\n            `${COMPONENT_NAME.value}-sender__button__default`,\n            textValue.value ? '' : `${COMPONENT_NAME.value}-sender__button--disabled`,\n          ]}\n          disabled={disabled.value || showStopBtn.value || !textValue.value}\n        >\n          <SendFilledIcon />\n        </Button>\n      );\n      // }\n    };\n    const renderSuffixIcon = () => {\n      const suffix = renderTNodeJSX('suffix');\n\n      return suffix ? suffix : getDefaultSuffixIcon();\n    };\n    return () => (\n      <div class={`${COMPONENT_NAME.value}-sender`}>\n        <div\n          class={[\n            `${COMPONENT_NAME.value}-sender__textarea`,\n            focusFlag.value ? `${COMPONENT_NAME.value}-sender__textarea--focus` : '',\n          ]}\n        >\n          <Textarea\n            ref={senderTextarea}\n            value={textValue.value}\n            onChange={textChange}\n            disabled={disabled.value || showStopBtn.value}\n            {...{\n              autosize: (props.textareaProps as TdChatSenderProps['textareaProps'])?.autosize || {\n                minRows: 2,\n                maxRows: 5,\n              },\n              ...(props.textareaProps as TdChatSenderProps['textareaProps']),\n            }}\n            onKeydown={keydownFn}\n            onKeyup={keyupFn}\n            onFocus={focusFn}\n            onBlur={blurFn}\n            onCompositionstart={compositionstartFn}\n            onCompositionend={compositionendFn}\n          />\n          <div class={`${COMPONENT_NAME.value}-sender__footer`}>\n            <div class={`${COMPONENT_NAME.value}-sender__mode`}>{renderContent('default', 'prefix')}</div>\n            <div class={`${COMPONENT_NAME.value}-sender__button`}>\n              {/* 发送按钮 */}\n              {!showStopBtn.value && (\n                <div class={`${COMPONENT_NAME.value}-sender__button__sendbtn`} onClick={sendClick}>\n                  {renderSuffixIcon()}\n                </div>\n              )}\n              {/* 停止按钮 */}\n              {showStopBtn.value && (\n                <div class={`${COMPONENT_NAME.value}-sender__button__stopbtn`}>\n                  <Button variant=\"text\" class={`${COMPONENT_NAME.value}-sender__button__default`} onClick={handleStop}>\n                    <div class={`${COMPONENT_NAME.value}-sender__button__stopicon`} />\n                  </Button>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","emits","setup","emit","_ref","shiftDownFlag","isComposition","senderTextarea","ref","COMPONENT_NAME","usePrefixClass","_toRefs","toRefs","value","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","textValue","setInnerValue","focusFlag","loading","showStopBtn","computed","stopDisabled","disabled","renderTNodeJSX","useTNodeJSX","renderContent","useContent","sendClick","e","handleStop","keydownFn","context","key","cancelBubble","preventDefault","stopPropagation","focusFn","blurFn","keyupFn","textChange","compositionstartFn","compositionendFn","getDefaultSuffixIcon","_createVNode","Button","concat","_default","SendFilledIcon","renderSuffixIcon","suffix","_props2$textareaProps","Textarea","_mergeProps","_objectSpread","autosize","textareaProps","minRows","maxRows"],"mappings":"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"}