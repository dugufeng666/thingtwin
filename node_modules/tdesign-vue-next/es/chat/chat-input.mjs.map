{"version":3,"file":"chat-input.mjs","sources":["../../../components/chat/chat-input.tsx"],"sourcesContent":["import { defineComponent, toRefs, computed } from 'vue';\nimport { RectangleIcon, SendIcon, StopCircleIcon } from 'tdesign-icons-vue-next';\nimport Button from '../button';\nimport Textarea from '../textarea';\n\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { usePrefixClass, useConfig } from '../hooks/useConfig';\nimport props from './chat-input-props';\nimport useVModel from '../hooks/useVModel';\n\nexport default defineComponent({\n  name: 'TChatInput',\n  components: {\n    RectangleIcon,\n    SendIcon,\n  },\n  props,\n  emits: ['send', 'stop', 'update:modelValue', 'blur', 'focus'], // declare the custom events here\n  setup(props, { slots, emit }) {\n    const COMPONENT_NAME = usePrefixClass('chat');\n    const { globalConfig } = useConfig('chat');\n    const { stopBtnText, placeholder } = globalConfig.value;\n    const { value, modelValue } = toRefs(props);\n    const [textValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n    // 按钮禁用，\n    const disabled = computed(() => props.stopDisabled);\n    // textarea禁用，\n    const textareaDisabled = computed(() => props.disabled);\n    // 输入框是否自动聚焦\n    const autofocus = computed(() => props.autofocus);\n    // 输入框高度\n    const autosize = computed(() => props.autosize);\n    // 输入框默认文案\n    const placeholderText = computed(() => props.placeholder ?? placeholder);\n\n    let shiftDownFlag = false;\n    let isComposition = false;\n    const renderTNodeJSX = useTNodeJSX();\n    const suffixIcon = renderTNodeJSX('suffixIcon') || slots.suffixIcon;\n    const sendClick = (e: MouseEvent | KeyboardEvent) => {\n      if (textValue.value && !disabled.value) {\n        emit('send', textValue.value, { e });\n        setInnerValue('', { e });\n      }\n    };\n\n    const handleStop = (e: MouseEvent) => {\n      emit('stop', textValue.value, {\n        e,\n      });\n    };\n\n    const textChange = (value: string, context: { e: InputEvent }) => {\n      setInnerValue(value, context);\n    };\n    const blurFn = (value: string, context: { e: FocusEvent }) => {\n      emit('blur', value, context);\n    };\n    const focusFn = (value: string, context: { e: FocusEvent }) => {\n      emit('focus', value, context);\n    };\n    const keydownFn = (value: string, context: { e: KeyboardEvent }) => {\n      const {\n        e: { key },\n      } = context;\n      if (key === 'Shift') {\n        shiftDownFlag = true;\n      }\n      if (key === 'Enter' && !shiftDownFlag && !isComposition) {\n        context.e.cancelBubble = true;\n        context.e.preventDefault();\n        context.e.stopPropagation();\n        sendClick(context.e);\n      }\n    };\n\n    const keyupFn = (value: any, context: any) => {\n      const {\n        e: { key },\n      } = context;\n      if (key === 'Shift') {\n        shiftDownFlag = false;\n      }\n    };\n\n    const compositionstartFn = () => {\n      isComposition = true;\n    };\n\n    const compositionendFn = () => {\n      isComposition = false;\n    };\n    // 默认suffixIcon\n    const getDefaultSuffixIcon = () => {\n      return (\n        <Button\n          theme=\"default\"\n          size=\"small\"\n          variant=\"text\"\n          class={[\n            `${COMPONENT_NAME.value}__footer__textarea__icon__default`,\n            textValue.value ? `${COMPONENT_NAME.value}__footer__textarea__icon--focus` : '',\n          ]}\n          disabled={disabled.value || !textValue.value || textareaDisabled.value}\n        >\n          <SendIcon />\n        </Button>\n      );\n    };\n    const renderSuffixIcon = () => {\n      return suffixIcon ? suffixIcon : getDefaultSuffixIcon();\n    };\n    return () => (\n      <div class={`${COMPONENT_NAME.value}__footer__content`}>\n        {/* textAreaBox */}\n        <div class={`${COMPONENT_NAME.value}__footer__textarea`}>\n          <Textarea\n            value={textValue.value}\n            class=\"noscrollbar\"\n            placeholder={placeholderText.value}\n            disabled={textareaDisabled.value}\n            autofocus={autofocus.value}\n            autosize={autosize.value}\n            onChange={textChange}\n            onBlur={blurFn}\n            onFocus={focusFn}\n            onKeydown={keydownFn}\n            onKeyup={keyupFn}\n            onCompositionstart={compositionstartFn}\n            onCompositionend={compositionendFn}\n          />\n          <div class={`${COMPONENT_NAME.value}__footer__textarea__icon`} onClick={sendClick}>\n            {renderSuffixIcon()}\n          </div>\n        </div>\n        {disabled.value && !textareaDisabled.value && (\n          <div class={`${COMPONENT_NAME.value}__footer__stopbtn`}>\n            <Button variant=\"outline\" onClick={handleStop}>\n              <StopCircleIcon />\n              {stopBtnText}\n            </Button>\n          </div>\n        )}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","components","RectangleIcon","SendIcon","props","emits","setup","slots","_ref","emit","COMPONENT_NAME","usePrefixClass","_useConfig","useConfig","globalConfig","_globalConfig$value","value","stopBtnText","placeholder","_toRefs","toRefs","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","textValue","setInnerValue","disabled","computed","stopDisabled","textareaDisabled","autofocus","autosize","placeholderText","_props2$placeholder","shiftDownFlag","isComposition","renderTNodeJSX","useTNodeJSX","suffixIcon","sendClick","e","handleStop","textChange","context","blurFn","focusFn","keydownFn","key","cancelBubble","preventDefault","stopPropagation","keyupFn","compositionstartFn","compositionendFn","getDefaultSuffixIcon","_createVNode","Button","concat","_default","renderSuffixIcon","Textarea","StopCircleIcon"],"mappings":"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"}